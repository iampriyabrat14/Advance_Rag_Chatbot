<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RAG ChatBot â€“ Advanced AI Assistant</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">ğŸ§ </div>
      <div>
        <h1>RAG ChatBot</h1>
        <span class="badge">Advanced AI</span>
      </div>
    </div>
    <button class="toggle-btn" id="sidebarToggle" title="Toggle sidebar">â—€</button>
  </div>

  <!-- Stats -->
  <div class="stats-card" id="statsCard">
    <h3>ğŸ“Š Knowledge Base</h3>
    <div class="stat-row">
      <span>Documents</span>
      <span class="stat-val" id="docCount">0</span>
    </div>
    <div class="stat-row">
      <span>Chunks</span>
      <span class="stat-val" id="chunkCount">â€”</span>
    </div>
    <div class="stat-row status-row">
      <span>Status</span>
      <span class="status-dot active" id="statusDot"></span>
    </div>
  </div>

  <!-- Upload -->
  <div class="upload-section">
    <h3>ğŸ“ Upload Documents</h3>
    <div class="upload-zone" id="uploadZone">
      <div class="upload-icon">ğŸ“„</div>
      <p>Drop PDF or TXT files</p>
      <span>or click to browse</span>
      <input type="file" id="fileInput" accept=".pdf,.txt" multiple hidden />
    </div>
    <div class="upload-progress" id="uploadProgress" style="display:none">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <p id="uploadStatus">Uploadingâ€¦</p>
    </div>
  </div>

  <!-- Document list -->
  <div class="doc-list-section">
    <div class="section-header">
      <h3>ğŸ“š Ingested Docs</h3>
      <button class="refresh-btn" id="refreshDocs" title="Refresh">âŸ³</button>
    </div>
    <ul id="docList" class="doc-list">
      <li class="empty-hint">No documents yet</li>
    </ul>
  </div>

  <!-- Settings -->
  <div class="settings-section">
    <h3>âš™ï¸ Retrieval Settings</h3>
    <label>Top-K Retrieve: <span id="topKVal">5</span>
      <input type="range" id="topK" min="1" max="10" value="5" />
    </label>
    <label>Re-rank Top-K: <span id="reRankVal">3</span>
      <input type="range" id="reRankK" min="1" max="5" value="3" />
    </label>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN CHAT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="chat-area">

  <!-- Header -->
  <header class="chat-header">
    <button class="mobile-menu-btn" id="mobileMenu">â˜°</button>
    <div class="header-info">
      <h2>Intelligent RAG Assistant</h2>
      <p>Retrieval-Augmented Generation Â· Re-ranking Â· Memory Â· Evaluation</p>
    </div>
    <div class="header-actions">
      <button class="btn-icon" id="evalPanelBtn" title="Evaluation Panel">ğŸ“ˆ</button>
      <button class="btn-icon" id="clearBtn" title="Clear conversation">ğŸ—‘</button>
    </div>
  </header>

  <!-- Pipeline steps indicator -->
  <div class="pipeline-bar">
    <div class="pipeline-step" id="ps-retrieve">ğŸ” Retrieve</div>
    <div class="arrow">â†’</div>
    <div class="pipeline-step" id="ps-rerank">ğŸ† Re-rank</div>
    <div class="arrow">â†’</div>
    <div class="pipeline-step" id="ps-generate">ğŸ¤– Generate</div>
    <div class="arrow">â†’</div>
    <div class="pipeline-step" id="ps-memory">ğŸ§© Memory</div>
  </div>

  <!-- Messages -->
  <div class="messages" id="messages">
    <div class="welcome-card">
      <div class="welcome-icon">ğŸš€</div>
      <h3>Welcome to RAG ChatBot</h3>
      <p>Upload PDF or TXT documents, then ask questions. The system will retrieve relevant context, re-rank it, and generate accurate answers.</p>
      <div class="feature-tags">
        <span>ğŸ“„ PDF + TXT</span>
        <span>ğŸ—„ï¸ ChromaDB</span>
        <span>ğŸ† Cross-Encoder Re-rank</span>
        <span>ğŸ§  Memory</span>
        <span>ğŸ“ˆ RAGAS Eval</span>
      </div>
    </div>
  </div>

  <!-- Input bar -->
  <div class="input-area">
    <div class="input-wrapper">
      <textarea
        id="userInput"
        placeholder="Ask anything about your documentsâ€¦"
        rows="1"
        maxlength="2000"
      ></textarea>
      <button class="send-btn" id="sendBtn" title="Send (Enter)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
    <div class="input-meta">
      <span id="charCount">0 / 2000</span>
      <span id="sessionInfo">Session active</span>
    </div>
  </div>
</main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EVALUATION PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="eval-panel" id="evalPanel">
  <div class="eval-header">
    <h3>ğŸ“ˆ RAG Evaluation</h3>
    <button id="closeEvalPanel">âœ•</button>
  </div>
  <div class="eval-body">
    <div class="eval-field">
      <label>Question</label>
      <textarea id="evalQ" placeholder="What isâ€¦" rows="2"></textarea>
    </div>
    <div class="eval-field">
      <label>Answer (model output)</label>
      <textarea id="evalA" placeholder="The answer isâ€¦" rows="3"></textarea>
    </div>
    <div class="eval-field">
      <label>Context chunks (one per line)</label>
      <textarea id="evalCtx" placeholder="Paste retrieved context chunksâ€¦" rows="4"></textarea>
    </div>
    <div class="eval-field">
      <label>Ground Truth <em>(optional)</em></label>
      <textarea id="evalGT" placeholder="Expected answerâ€¦" rows="2"></textarea>
    </div>
    <button class="run-eval-btn" id="runEval">â–¶ Run Evaluation</button>
    <div id="evalResults" class="eval-results" style="display:none"></div>
  </div>
</div>
<div class="overlay" id="overlay"></div>

<!-- Sources modal -->
<div class="modal" id="sourcesModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ” Retrieved Sources & Re-ranking</h3>
      <button id="closeModal">âœ•</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
